<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Please Test Me...</title>
<script>
//By Terry Sperringer via Notepad++
/** globals **/
var VD; //handle to app -to be initialized with a new instance

function app() //definition of app 'class'
{
    /** private members **/
    var that = this;
    var my_x;
    var my_y;
    var FPS = 50; //Frames Per Second...maybe we'll add animation or other time-based things later
    var drag = false;
    var canvas = document.getElementById('my_canvas'); //canvas handle
        //touch event handlers
        canvas.addEventListener('touchstart', function(that){ that.dragOn(); alert(that); }, false);
        canvas.addEventListener('touchend', function(that){ that.dragoff(); }, false);
        canvas.addEventListener('touchmove', function(that){that.translateCoords(); }, false);
    var context = my_canvas.getContext("2d"); //controls canvas 'modes'
    var heart = new Image();
        heart.src = "small_heart.gif";
    var background = new Image();
        background.src = "happy_vday.png";
    var name = getUrlVars()["name"];
    
    if(getUrlVars()["name"] == undefined) { name = "Meghan"; } //grabs the url variable, "name"
    
    setInterval(loop, 1000 / FPS); //the loop will repeat every 1000 / FPS ms
    
    /** private methods **/
    function drawTrail() //draws a trail of hearts
    {
        context.drawImage(heart, my_x - (heart.width >> 1), my_y - (heart.height >> 1));
    }
    
    function loop() //the main loop of the app
    {
        if(drag) { drawTrail(); }
        
        return;
    }
    
    function getUrlVars() //method used to obtain url variables
    {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value){
            vars[key] = value;
        });
        
        return vars;
    }
    
    /** public methods **/
    this.refresh = function() //overwrites canvas with background graphics: an image and name
    {
        context.drawImage(background, 0, 0);
        context.fillStyle = "#000000";
        context.fillStyle = "rgb(255, 0, 0)";
        context.font = "36px Brush Script MT"; //"30px Arial";
        context.fillText(name + '!', 150, 170);
        
        return;
    }
    
    this.translateCoords = function(event) //translates from page coordinates to canvas coordinates
    {
        my_x = event.pageX - canvas.offsetLeft;
        my_y = event.pageY - canvas.offsetTop;
        
        var touches = event.changedTouches;
        if(touches)
        {
            my_x = touches[0].pageX - canvas.offsetLeft;
            my_y = touches[0].pageY - canvas.offsetTop;
        }
        
        return;
    }
    
    this.dragOn = function(){ drag = true; } //drag on (here be drag-on's)
    
    this.dragOff = function(){ drag = false; } //drag off (slurred pittsburgh-ese insult)
    
    return;
}
</script>
</head>

<body style="background-color:#ff9999" onload="VD = new app();" onmousedown="VD.dragOn();" onmouseup="VD.dragOff();">
    <canvas id="my_canvas" width="400" height="300" style="background-color:#000000; border:1px solid #000000;" onmousemove="VD.translateCoords(event);">
        Your browser doesn't support the canvas tag and is incompatible. Try Firefox or Chrome =P
    </canvas>
    <br />
    <button onclick="VD.refresh();">Clear Canvas</button>
</body>
</html>
