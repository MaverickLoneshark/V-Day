<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width,user-scalable=no">
<title>Please Test Me...</title>
<script>
//By Terry Sperringer via Notepad++
/** globals **/
var VD; //handle to app -to be initialized with a new instance

function app() //definition of app 'class'
{
    /** private members **/
    var my_x;
    var my_y;
    var drag = false;
    var canvas = document.getElementById('my_canvas'); //canvas handle
        //touch event handlers
        canvas.addEventListener('touchstart', function(event){ VD.drawTrail(event); }, false);
        canvas.addEventListener('touchmove', function(event){ VD.drawTrail(event); }, false);
        canvas.addEventListener('touchend', function(event){ VD.drawTrail(event); }, false);
    var context = my_canvas.getContext("2d"); //controls canvas 'modes'
    var heart = new Image();
        heart.src = "small_heart.gif";
    var background = new Image();
        background.src = "happy_vday.png";
    var name = getUrlVars()["name"];
    
    if(getUrlVars()["name"] == undefined) { name = "Meghan"; } //grabs the url variable, "name"
    
    document.addEventListener('touchmove', function(event){ event.preventDefault(); }, false);
    
    /** private methods **/
    function getUrlVars() //method used to obtain url variables
    {
        var vars = {};
        var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value){
            vars[key] = value;
        });
        
        return vars;
    }
    
    function translateCoords(event) //translates from page coordinates to canvas coordinates
    {
        my_x = event.pageX - canvas.offsetLeft;
        my_y = event.pageY - canvas.offsetTop;
        
        return;
    }
    
    /** public methods **/
    this.refresh = function() //overwrites canvas with background graphics: an image and name
    {
        context.drawImage(background, 0, 0);
        context.fillStyle = "rgb(255, 0, 0)";
        context.font = "36px Brush Script MT"; //"30px Arial";
        context.fillText(name + '!', 150, 170);
        
        return;
    }
    
    this.drawTrail = function(event) //draws a trail of hearts
    {
var debug = document.getElementById('DEBUG');
debug.innerHTML = event.targetTouches;
        if(event.targetTouches)
        {
            var touches = event.targetTouches;
debug.innerHTML = touches.length;
            for(var i = 0; i < touches.length; i++)
            {
                my_x = touches[i].pageX - canvas.offsetLeft;
                my_y = touches[i].pageY - canvas.offsetTop;
                context.drawImage(heart, my_x - (heart.width >> 1), my_y - (heart.height >> 1));
            }
        }
        else if(drag)
        {
            translateCoords(event);
            context.drawImage(heart, my_x - (heart.width >> 1), my_y - (heart.height >> 1));
        }
        
        return;
    }
    
    this.dragOn = function(){ drag = true; } //drag on (here be drag-on's)
    
    this.dragOff = function(){ drag = false; } //drag off (slurred pittsburgh-ese insult)
    
    return;
}
</script>
</head>

<body style="background-color:#ff9999" onload="VD = new app();" onmouseup="VD.dragOff();">
    <canvas id="my_canvas" width="400" height="300" style="background-color:#000000; border:1px solid #000000;" onmousedown="VD.dragOn();" onmousemove="VD.drawTrail(event);">
        Your browser doesn't support the canvas tag and is incompatible. Try Firefox or Chrome =P
    </canvas>
    <br />
    <button onclick="VD.refresh();">Clear Canvas</button>
    <p id="DEBUG">debug info</p>
</body>
</html>
